<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css"
    />
  </head>

  <body>
    <div>
      <h1 class="manageTitle">Management</h1>

      <h2 id="table_title">Manage Pets</h2>
      <div class="managementNavigation">
        <button class="navBtn" type="button">Manage Pets</button>
        {% if user.role =='admin' %}
        <button class="navBtn" type="button">Manage Shelters</button>
        <button class="navBtn" type="button">Manage Users</button>
        {% endif %}
      </div>

      <table id="manageShelters">
        <thead>
          <tr>
            <th>id</th>
            <th>name</th>
            <th>address</th>
            <th>po_box</th>
            <th>email</th>
            <th>phone_number</th>
            <th>actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
      <script>
        $(document).ready(function () {
          var table = $("#manageShelters").DataTable({
            ajax: {
              url: "/api/shelters",
              method: "GET",
              dataSrc: "",
            },
            columns: [
              { data: "id" },
              { data: "name" },
              { data: "address" },
              { data: "po_box" },
              { data: "email" },
              { data: "phone_number" },
              {
                data: null,
                render: function (data, type, row) {
                  var editBtn = '<a href="/pet/edit/' + data.id + '">Edit</a>';
                  var deleteBtn =
                    '<a href="#" class="delete-shelter" data-id="' +
                    data.id +
                    '">Delete</a>';
                  return editBtn + " | " + deleteBtn;
                },
              },
            ],
          });

          // Attach click event handler to delete buttons
          $("#manageShelters").on("click", ".delete-shelter", function (e) {
            e.preventDefault();
            var shelterID = $(this).data("id");
            deleteShelter(shelterID);
          });

          // Function to delete a shelter using AJAX
          function deleteShelter(shelterID) {
            $.ajax({
              url: "/api/shelters/" + shelterID,
              method: "DELETE",
              success: function (response) {
                // Handle success response
                console.log("Shelter deleted successfully");
                // Refresh the DataTable
                table.ajax.reload();
              },
              error: function (error) {
                // Handle error response
                console.error("Error deleting Shelter:", error);
              },
            });
          }
        });
      </script>
    </div>
  </body>
</html>
